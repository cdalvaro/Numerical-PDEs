stages:
  - analyze
  - test
  - build
  - archive

analyze_project:
  stage: analyze
  script:
    - xcodebuild clean analyze -project ComputationalPhysics.xcodeproj -scheme 'Computational Physics' -configuration Debug | xcpretty -f `xcpretty-travis-formatter`
  tags:
    - Xcode
    - macOS

test_project:
  stage: test
  script:
    - xcodebuild test -project ComputationalPhysics.xcodeproj -scheme 'Computational Physics' -configuration Debug -enableCodeCoverage YES | xcpretty --test --tap --report html
    - slather coverage --scheme 'Computational Physics' --show ComputationalPhysics.xcodeproj
  tags:
    - Xcode
    - macOS

build_project:
  stage: build
  script:
    - xcodebuild clean build -project ComputationalPhysics.xcodeproj -scheme 'Computational Physics' -configuration Release | xcpretty -f `xcpretty-travis-formatter`
  tags:
    - Xcode
    - macOS

archive_project:
  stage: archive
  script:
    - xcodebuild archive -archivePath build/ComputationalPhysics -scheme 'Computational Physics' -configuration Release | xcpretty -f `xcpretty-travis-formatter`
  only:
    - master
  artifacts:
    paths:
    - build/ComputationalPhysics.xcarchive
  tags:
    - Xcode
    - macOS
