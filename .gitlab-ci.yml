stages:
  - analyze
  - test
  - build
  - archive

analyze_project:
  stage: analyze
  script:
    - xcodebuild clean analyze -project NumericalPDEs.xcodeproj -scheme 'Numerical PDEs' -configuration Debug | xcpretty -f `xcpretty-travis-formatter`
  tags:
    - Xcode
    - macOS

test_project:
  stage: test
  script:
    - xcodebuild test -project NumericalPDEs.xcodeproj -scheme 'Numerical PDEs' -configuration Debug -enableCodeCoverage YES | xcpretty --test --tap --report html
    - slather coverage --scheme 'Numerical PDEs' --show NumericalPDEs.xcodeproj
  tags:
    - Xcode
    - macOS

build_project:
  stage: build
  script:
    - xcodebuild clean build -project NumericalPDEs.xcodeproj -scheme 'Numerical PDEs' -configuration Release | xcpretty -f `xcpretty-travis-formatter`
  tags:
    - Xcode
    - macOS

archive_project:
  stage: archive
  script:
    - xcodebuild archive -archivePath build/NumericalPDEs -scheme 'Numerical PDEs' -configuration Release | xcpretty -f `xcpretty-travis-formatter`
  only:
    - master
  artifacts:
    paths:
    - build/NumericalPDEs.xcarchive
  tags:
    - Xcode
    - macOS
